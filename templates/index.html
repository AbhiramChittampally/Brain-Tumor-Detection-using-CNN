<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Brain Tumor Detection</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #50e3c2;
            --dark-bg: #1f2a38;
            --light-bg: #2a3b4f;
            --text-color: #e0e0e0;
            --text-secondary: #a0b0c0;
            --success-color: #28a745;
            --error-color: #dc3545;
            --border-radius: 12px;
            --transition-speed: 0.5s;
        }

        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--dark-bg);
            /* NOTE: Replace this URL with the link to your own 3D brain background image */
            background-image: url('REPLACE_WITH_YOUR_BRAIN_IMAGE_URL.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: var(--text-color);
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 900px;
            text-align: center;
            padding: 2rem;
            box-sizing: border-box;
        }

        #upload-container {
            background: rgba(42, 59, 79, 0.85);
            backdrop-filter: blur(10px);
            padding: 40px 50px;
            border-radius: var(--border-radius);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            transition: all var(--transition-speed) ease;
        }

        #upload-container h1 {
            font-weight: 700;
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #ffffff;
        }

        #upload-container p {
            color: var(--text-secondary);
            margin-bottom: 30px;
            font-size: 1.1rem;
        }

        .upload-area {
            border: 2px dashed var(--primary-color);
            border-radius: var(--border-radius);
            padding: 40px 20px;
            margin-bottom: 30px;
            cursor: pointer;
            transition: background-color 0.3s ease, border-color 0.3s ease;
            position: relative;
        }

        .upload-area.hover {
            background-color: rgba(74, 144, 226, 0.1);
            border-color: var(--secondary-color);
        }

        .upload-area input[type="file"] {
            display: none;
        }
        
        .upload-icon {
            width: 60px;
            height: 60px;
            margin-bottom: 20px;
        }

        .upload-text {
            font-size: 1.2em;
            font-weight: 600;
            color: var(--text-color);
        }
        
        #image-preview {
            max-width: 200px;
            max-height: 200px;
            margin-top: 20px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: none;
        }
        
        .file-name {
            font-size: 1em;
            color: var(--secondary-color);
            font-weight: bold;
            margin-top: 15px;
        }

        .predict-button {
            background-image: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            width: 100%;
            max-width: 400px;
        }

        .predict-button:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(74, 144, 226, 0.4);
        }
        
        .predict-button:disabled {
            background-image: none;
            background-color: #555;
            opacity: 0.5;
            cursor: not-allowed;
        }

        .loading-spinner {
            border: 5px solid rgba(255, 255, 255, 0.2);
            border-left-color: var(--secondary-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            display: none;
            margin: 30px auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        #result-container {
            display: none;
            opacity: 0;
            transform: translateY(30px);
            transition: opacity var(--transition-speed) ease, transform var(--transition-speed) ease;
        }
        
        .result-card {
            background: rgba(42, 59, 79, 0.9);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: var(--border-radius);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            display: flex;
            gap: 40px;
            align-items: center;
            text-align: left;
        }
        
        .result-image-col {
            flex: 1;
        }
        
        .result-info-col {
            flex: 2;
        }

        .result-image-col img {
            width: 100%;
            max-width: 300px; /* Added max-width for consistency */
            border-radius: var(--border-radius);
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        
        #result-title {
            font-size: 2.2rem;
            font-weight: 700;
            margin: 0 0 15px 0;
        }
        
        .confidence-box {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .confidence-box span {
            color: var(--secondary-color);
            font-size: 1.5rem;
        }
        
        #result-description {
            font-size: 1rem;
            line-height: 1.6;
            color: var(--text-secondary);
        }
        
        .result-card.no-tumor { border-left: 7px solid var(--success-color); }
        #result-title.no-tumor { color: var(--success-color); }
        
        .result-card.glioma { border-left: 7px solid #e74c3c; }
        #result-title.glioma { color: #e74c3c; }
        
        .result-card.meningioma { border-left: 7px solid #f39c12; }
        #result-title.meningioma { color: #f39c12; }
        
        .result-card.pituitary { border-left: 7px solid #9b59b6; }
        #result-title.pituitary { color: #9b59b6; }
        
        #error-message {
            color: var(--error-color);
            margin-top: 15px;
            font-weight: bold;
            background: rgba(220, 53, 69, 0.1);
            padding: 10px;
            border-radius: 8px;
            display: none;
        }

        .reset-button {
            margin-top: 30px;
            background: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            padding: 12px 25px;
            font-size: 1.1em;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
        }

        .reset-button:hover {
            background-color: var(--primary-color);
            color: white;
        }
        
        @media (max-width: 768px) {
            .result-card {
                flex-direction: column;
                text-align: center;
            }
            #upload-container {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="upload-container">
            <h1>Brain Tumor Detection</h1>
            <p>Upload an MRI scan to classify the type of brain tumor.</p>

            <div class="upload-area" id="dropArea">
                <input type="file" id="fileInput" accept=".png, .jpg, .jpeg">
                <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM0YTkwZTIiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0ibHVjaWRlIGx1Y2lkZS1jbG91ZC11cGxvYWQiPjxwYXRoIGQ9Ik00IDE0LjUgQTUuNSA1LjUgMCAwIDEgMTUgNEExNSA1IDAgMCAxIDIwIDEwIi8+PHBhdGggZD0iTTEyIDEyIFYyMiIvPjxwYXRoIGQ9Im0xNiAxNiAtNCAtNCAwIDAgLTQgNCIvPjwvc3ZnPg==" alt="Upload Icon" class="upload-icon">
                <p class="upload-text"><strong>Drag & Drop</strong> your MRI scan here<br>or Click to Upload</p>
            </div>
            
            <img id="image-preview" src="#" alt="Your MRI Scan">
            <p class="file-name" id="fileName"></p>
            
            <div class="loading-spinner" id="loadingSpinner"></div>
            <p id="error-message"></p>

            <button class="predict-button" id="predictButton">Analyze Scan</button>
        </div>

        <div id="result-container">
            <div class="result-card" id="resultCard">
                <div class="result-image-col">
                    <img id="result-image" src="" alt="Tumor Type Image">
                </div>
                <div class="result-info-col">
                    <h2 id="result-title"></h2>
                    <p class="confidence-box">Confidence: <span id="confidenceResult"></span></p>
                    <p id="result-description"></p>
                </div>
            </div>
            <button class="reset-button" id="resetButton">Try Another Scan</button>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const uploadContainer = document.getElementById('upload-container');
        const dropArea = document.getElementById('dropArea');
        const fileInput = document.getElementById('fileInput');
        const fileNameSpan = document.getElementById('fileName');
        const imagePreview = document.getElementById('image-preview');
        const predictButton = document.getElementById('predictButton');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const errorMessage = document.getElementById('error-message');
        
        const resultContainer = document.getElementById('result-container');
        const resultCard = document.getElementById('resultCard');
        const resultImage = document.getElementById('result-image');
        const resultTitle = document.getElementById('result-title');
        const confidenceResult = document.getElementById('confidenceResult');
        const resultDescription = document.getElementById('result-description');
        const resetButton = document.getElementById('resetButton');

        let uploadedFile = null;
        
        // --- Data for Tumor Types (descriptions only now) ---
        const tumorInfo = {
            glioma: {
                title: "Glioma Tumor",
                description: "Gliomas are a type of tumor that starts in the glial cells of the brain or spine. These cells surround nerve cells and help them function. Gliomas are classified by the type of glial cell involved and by their genetic features, which can help predict their behavior over time.",
            },
            meningioma: {
                title: "Meningioma Tumor",
                description: "A meningioma is a tumor that arises from the meninges — the membranes that surround your brain and spinal cord. Most meningiomas are noncancerous (benign), though, in rare cases, they can be malignant. They are often slow-growing.",
            },
            pituitary: {
                title: "Pituitary Tumor",
                description: "Pituitary tumors are abnormal growths that develop in your pituitary gland. Some pituitary tumors result in too many of the hormones that regulate important functions of your body. Most are benign (noncancerous) adenomas that remain in the gland or surrounding tissues.",
            },
            no_tumor: {
                title: "No Tumor Detected",
                description: "The analysis did not find any evidence of a tumor in the provided MRI scan. This is a positive indication of normal brain tissue. Regular check-ups are always recommended for maintaining good health.",
            }
        };

        // --- Event Listeners & Functions ---
        dropArea.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', (e) => handleFiles(e.target.files));
        resetButton.addEventListener('click', resetUI);

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
            document.body.addEventListener(eventName, preventDefaults, false);
        });

        ['dragenter', 'dragover'].forEach(eventName => dropArea.addEventListener(eventName, () => dropArea.classList.add('hover'), false));
        ['dragleave', 'drop'].forEach(eventName => dropArea.addEventListener(eventName, () => dropArea.classList.remove('hover'), false));

        dropArea.addEventListener('drop', handleDrop, false);
        predictButton.addEventListener('click', handlePrediction);

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        function handleDrop(e) {
            const dt = e.dataTransfer;
            handleFiles(dt.files);
        }

        function handleFiles(files) {
            if (files.length === 0) return;
            uploadedFile = files[0];
            
            if (uploadedFile && uploadedFile.type.startsWith('image/')) {
                fileNameSpan.textContent = uploadedFile.name;
                const reader = new FileReader();
                reader.onload = e => {
                    imagePreview.src = e.target.result;
                    imagePreview.style.display = 'block';
                };
                reader.readAsDataURL(uploadedFile);
                hideError();
            } else {
                showError('Please upload a valid image file (.png, .jpg, .jpeg).');
                resetFileInput();
            }
        }

        async function handlePrediction() {
            if (!uploadedFile) {
                showError('Please upload an image first.');
                return;
            }

            showLoading(true);
            hideError();

            const formData = new FormData();
            formData.append('file', uploadedFile);

            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Prediction failed on the server.');
                }
                
                displayResults(data);

            } catch (error) {
                console.error('Prediction Error:', error);
                showError(`Error: ${error.message}`);
                showLoading(false);
            }
        }
        
        function displayResults(data) {
            const predictionKey = data.prediction.toLowerCase().replace(' ', '_');
            const info = tumorInfo[predictionKey];
            
            if (info) {
                resultTitle.textContent = info.title;
                resultDescription.textContent = info.description;
                confidenceResult.textContent = data.confidence;
                
                // ---- THIS IS THE MODIFIED LINE ----
                resultImage.src = imagePreview.src; // Use the user's uploaded image

                resultCard.className = 'result-card';
                resultTitle.className = '';
                if (predictionKey !== 'no_tumor') {
                    resultCard.classList.add(predictionKey);
                    resultTitle.classList.add(predictionKey);
                } else {
                    resultCard.classList.add('no-tumor');
                    resultTitle.classList.add('no-tumor');
                }

                uploadContainer.style.opacity = '0';
                setTimeout(() => {
                    uploadContainer.style.display = 'none';
                    resultContainer.style.display = 'block';
                    setTimeout(() => {
                        resultContainer.style.opacity = '1';
                        resultContainer.style.transform = 'translateY(0)';
                    }, 50);
                }, 500);

            } else {
                showError(`Unknown prediction result: ${data.prediction}`);
            }

            showLoading(false);
        }

        function resetUI() {
            resultContainer.style.opacity = '0';
            setTimeout(() => {
                resultContainer.style.display = 'none';
                uploadContainer.style.display = 'block';
                setTimeout(() => {
                    uploadContainer.style.opacity = '1';
                }, 50);
            }, 500);

            resetFileInput();
            hideError();
        }

        function resetFileInput() {
            uploadedFile = null;
            fileInput.value = '';
            fileNameSpan.textContent = '';
            imagePreview.style.display = 'none';
            imagePreview.src = '#';
        }

        function showLoading(isLoading) {
            loadingSpinner.style.display = isLoading ? 'block' : 'none';
            predictButton.disabled = isLoading;
            predictButton.textContent = isLoading ? 'Analyzing...' : 'Analyze Scan';
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
        }

        function hideError() {
            errorMessage.style.display = 'none';
        }
    </script>
</body>
</html>